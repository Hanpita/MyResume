<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF在线预览（兼容所有浏览器）</title>
    <!-- 引入 PDF.js 核心库（用 bootcdn 国内节点，加载更快） -->
    <script src="https://cdn.bootcdn.net/ajax/libs/pdf.js/4.8.69/pdf.min.js"></script>
    <!-- 引入 PDF.js 样式（优化预览体验） -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/pdf.js/4.8.69/pdf_viewer.min.css">
    <style>
        /* 全屏适配，兼容手机和电脑 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #f5f5f5; min-height: 100vh; }
        .pdf-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        /* 加载提示样式 */
        .loading { text-align: center; padding: 50px 0; color: #666; font-size: 16px; }
        /* 错误提示样式 */
        .error { text-align: center; padding: 50px; color: #ff4d4f; font-size: 16px; }
        .error a { color: #1890ff; text-decoration: none; }
    </style>
</head>
<body>
    <div class="pdf-container">
        <div class="loading">PDF加载中... 请稍候</div>
        <!-- PDF预览容器（由PDF.js自动填充） -->
        <div id="pdfViewer" class="pdfViewer" style="display: none;"></div>
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        // 关键修改：用相对路径引用同级目录的 PDF（无需 CDN 链接）
        const pdfUrl = "PeishiHan_UXUI_Resume.pdf"; // 直接写文件名，因为和 html 文件同级
        
        // 2. 初始化PDF.js（适配所有浏览器的核心配置）
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.bootcdn.net/ajax/libs/pdf.js/4.8.69/pdf.worker.min.js';

        // 3. 渲染PDF到页面（兼容逻辑）
        async function renderPdf() {
            try {
                // 加载PDF（处理跨域、中文乱码、大文件分片加载）
                const pdfDoc = await pdfjsLib.getDocument({
                    url: pdfUrl,
                    cMapPacked: true, // 解决中文乱码（关键）
                    cMapUrl: 'https://cdn.bootcdn.net/ajax/libs/pdf.js/4.8.69/cmaps/', // 中文映射文件
                    rangeChunkSize: 65536, // 分片加载大文件（避免超时）
                    withCredentials: false // 兼容跨域访问
                }).promise;

                // 隐藏加载提示，显示预览容器
                document.querySelector('.loading').style.display = 'none';
                document.getElementById('pdfViewer').style.display = 'block';

                // 获取预览容器，初始化PDF查看器
                const container = document.getElementById('pdfViewer');
                const viewer = new pdfjsLib.PDFViewer({
                    container: container,
                    scale: 1.2, // 默认缩放比例（适配大多数屏幕）
                    showPageLabels: true, // 显示页码
                    showZoomButtons: true, // 显示缩放按钮
                    showDownloadButton: true, // 显示下载按钮（用户可手动保存）
                    showPrintButton: true, // 显示打印按钮
                    showBookmarkButton: true // 显示书签按钮
                });

                // 关联PDF文档到查看器
                viewer.setDocument(pdfDoc);

                // 适配窗口大小变化（兼容手机横屏/竖屏）
                window.addEventListener('resize', () => {
                    viewer.currentScaleValue = 'page-fit'; // 自适应窗口
                });

            } catch (error) {
                // 加载失败时显示错误提示
                document.querySelector('.loading').style.display = 'none';
                const errorEl = document.getElementById('error');
                errorEl.style.display = 'block';
                errorEl.innerHTML = `
                    PDF加载失败，请尝试：<br>
                    1. <a href="${pdfUrl}" target="_blank">直接下载查看</a><br>
                    2. 刷新页面重试（Ctrl+Shift+R）
                `;
                console.error('PDF加载错误：', error);
            }
        }

        // 页面加载完成后执行渲染（兼容异步加载）
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            renderPdf();
        } else {
            document.addEventListener('DOMContentLoaded', renderPdf);
        }
    </script>
</body>
</html>
